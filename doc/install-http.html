<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<title>Cyrus HTTP</title>
</head>
<body>

<h1>Cyrus HTTP (RSS, CalDAV, CardDAV)</h1>

<b><i>Note that the HTTP service and associated modules in Cyrus are
    still under development.  This release should be considered beta
    quality.</i></b>

<h2>Introduction</h2>

<p>Cyrus <tt>http</tt> service has the ability to:</p>

<ul>
<li>Serve IMAP mailboxes as RSS feeds.</li>
<li>Act as a calendar and scheduling (CalDAV) server by using IMAP
  mailboxes as calendar collections and RFC 5322 messages to store
  iCalendar data.</li>
<li>Act as a contacts (CardDAV) server by using IMAP mailboxes as
  addressbook collections and RFC 5322 messages to store vCard
  data.</li>
</ul>

<i>Unlike the <a href="http://httpd.apache.org/">Apache HTTP
    Server</a>, Cyrus HTTP is NOT a general purpose HTTP server.  Its
    feature set is limited to what is required to support the
    facilities listed above.</i>

<!--
<p>The Cyrus CalDAV implementation is not yet complete and currently
  does NOT support scheduling, WebDAV ACLs, or all required CalDAV
  reports.  Work on these features is ongoing.  The server has been
  tested with the Mozilla Sunbird/Lightning, Apple iCal, and Evolution
  clients.</p>
-->

<p>This document assumes that you have successfully been able to setup
  your Cyrus server.  If you have not already done so, please refer
  to the rest of the documentation.  This document also assumes that you
  are familiar with RSS, calendaring, and contacts.</p>

<h2>Installation</h2>

<p>You will need to build Cyrus with 
  the <tt>--enable-http</tt> configure option.  This builds httpd
  and the associated modules and utilities based on the availability
  of the prerequisites listed below.</p>

<h3>General Requirements</h3>

<ul>
<li>Must have <a href="http://xmlsoft.org/">libxml2</a>
  installed.</li>
<li>Must have a recent SASL build (v2.1.25 or later) in order to
  support HTTP Digest, Negotiate, and NTLM <b>(???)</b> authentication.
  Otherwise, only HTTP Basic authentication will be available</li>
</ul>

<h3>CalDAV / CardDAV Requirements</h3>
<ul>
<li>Must
  have <a href="http://freeassociation.sourceforge.net/">libical</a>
  installed.</li>
<li>Must have <a href="http://www.sqlite.org/">SQLite</a> v3.x (or
  later) installed.</li>
</ul>

<!--
<h3>iSchedule Requirements</h3>
<ul>
<li>Must
  have <a href="http://www.opendkim.org/">OpenDKIM v2.9.x (or higher)</a>
  installed.</li>
</ul>
-->

<h2>General Configuration</h2>

<p>The Cyrus <tt>httpd</tt> service is configurable via several
  options in <tt>imapd.conf</tt>.  Several of those options are
  discussed in the sections below.  Admins should consult
  the <tt>imapd.conf(5)</tt> manpage for the full list of options used
  by the <tt>httpd</tt> service and its various modules.<p>

<p>The support for RSS, CalDAV, and CardDAV is divided into separate
  modules which run as part of the Cyrus <tt>httpd</tt>
  service.  Selection of which module(s) are enabled is
  done by setting the <tt>httpmodules</tt> option accordingly.  By
  default, no modules are enabled.</p>

<p>Cyrus <tt>httpd</tt> also can serve <i>static</i> content, the
  location of which is set by the <tt>httpdocroot</tt> option.  Any
  content contained in the specified directory (including
  sub-directories) will be served as static content only.
  Cyrus <tt>httpd</tt> does NOT have the ability to execute any
  server-side scripts.</p>

<h3>HTTP Authentication</h3>

<p>As with other Cyrus services, the Cyrus <tt>httpd</tt> service uses
  Cyrus SASL to perform its authentication.  Cyrus supports the
  following HTTP authentication schemes: Basic, Digest, Negotiate
  (Kerberos only), and NTLM.  While Basic is available in all versions
  of SASL, the remaining schemes are only available in Cyrus SASL
  2.1.16 (and higher).</p>

<p>Similar to plaintext login commands in the other Cyrus services
  (IMAP LOGIN, POP3 USER/PASS), the Cyrus <tt>httpd</tt> service
  determines whether to advertise the HTTP Basic authentication scheme
  based on the <tt>allowplaintext</tt> option and whether the client
  has connected over a TLS protected connection (HTTPS).</p>

<p>The availability of the other HTTP authentication schemes is
  controlled by the <tt>sasl_mech_list</tt> option.  For
  Cyrus <tt>httpd</tt> the <tt>DIGEST-MD5</tt>, <tt>GSS-SPNEGO</tt>,
  and <tt>NTLM</tt> SASL plugins support the Digest, Negotiate,
  and NTLM authentication schemes respectively, provided that the
  plugins are installed on the server.</p>

<h2>RSS Module</h2>

<h3>Configuration</h3>

<p>When enabled, the RSS module will default to serving ALL mailboxes
  to which the authenticated user has access as RSS feeds.
  The <tt>rss_feeds</tt> option can be used to limit the set of
  mailboxes that can be served as RSS feeds.  For example,
  setting <tt>rss_feeds</tt> to <tt>*,!user</tt> will serve all shared
  mailboxes, but no personal mailboxes.</p>

<p>The list of available RSS feeds can be obtained by clients by
  accessing the <tt>/rss/</tt> URL on the Cyrus server.  By default,
  the server will present the list as a simple unordered list in an
  HTML document.  To customize the look and feel of the feed list,
  the <tt>rss_feedlist_template</tt> option can be used to point to a
  HTML template file.  This file can utilize Cascading Style Sheets,
  JavaScript, etc.  Any and all content that the template file
  references MUST reside under the <tt>httpdocroot</tt> as set above.
  Consult the <tt>imapd.conf(5)</tt> manpage for specifics on the
  required contents of   this custom file.  Note that for sites
  running Cyrus Murder,  <tt>rss_feedlist_template</tt> only needs to
  be set on frontend servers, since only those servers have the
  complete mailbox list.</p>

<h2>CalDAV Module</h2>

<h3>Configuration</h3>

<p>When enabled, the CalDAV module allows Cyrus to function as a
  calendar and scheduling server.  This module uses a subset of the
  mailbox hierarchy as calendar collections, the toplevel of which is
  specified by the <tt>calendarprefix</tt> option.  The public
  calendar hierarchy will reside at the toplevel of the shared mailbox
  namespace.  A user's personal calendar hierarchy will be a child of
  their Inbox.  For example, using the default value
  for <tt>calendarprefix</tt>, a calendar named <tt>Default</tt> for
  user <tt>murch</tt> would reside in the mailbox
  named <tt>user.murch.#calendars.Default</tt>.<p>

<p><i>Note that mailboxes in the calendar hierarchies (those
  under <tt>calendarprefix</tt>) <b>SHOULD NOT</b> be accessed with an IMAP
  client as doing so will leave a mailbox in a state unsuitable
  for CalDAV.  To this end, calendar mailboxes will not returned by
  Cyrus <tt>imapd</tt> in response to an IMAP client's request for the
  available mailbox list, but Cyrus <tt>imapd</tt> will not otherwise
  prevent an IMAP client from accessing them.</i></p>

<p>By default, the CalDAV module will automatically perform scheduling
  operations when a scheduling object (invitation or reply) is stored
  on or deleted from the server.  Support for the calendar-auto-schedule
  feature can be disabled with the <tt>caldav_allowscheduling</tt>
  option.</p>

<!--
<p>Some CalDAV clients don't support the creation of calendars, so it is
  best to provision at least one calendar for each user.  To provision a
  user to have an "events" calendar, you would create a mailbox such
  as <tt>user.&lt;userid&gt;.#calendars.events</tt></p>
-->

<h3>Administration</h3>

<h4>Calendar provisioning</h4>

<p>The CalDAV module with automatically create the required calendars
  for a user the first time that the user authenticates to the CalDAV
  server.  Note that the user MUST have an
  existing <a href="install-admin-mb.html">IMAP Inbox</a> in order for
  the calendars to be created.</p>

<h4>Calendar access controls</h4>

<p>IMAP rights -> DAV privileges</p>

<h3>Client Setup</h3>

<h4>Mozilla Lightning</h4>

<p>For each calendar that you would like to add to this client,
  perform the following steps:

<ol>
<li>Select the "File / New / Calendar..." menu option.</li>
<li>Select the "On the Network" option and click Continue.</li>
<li>Select "CalDAV" as the Format.</li>
<li>Enter a URL of the following form as
  the Location: <tt>https://&lt;servername&gt;/dav/calendars/user/&lt;userid&gt;/&lt;calendar&gt;/</tt></li>
</ol>
</p>
<p>Cyrus will auto-provision a calendar with name "Default" which can
  be used in the URL above.</p>

<h4>Apple iCal</h4>

<p>This client will autodetect all available calendars on a server.
  To add a Cyrus server to this client, perform the following steps:

<ol>
<li>Select the "Calendar / Preferences" menu option.</li>
<li>Select the "Accounts" tab.</li>
<li>Click the "+" button.</li>
<li>Select "CalDAV" as the Account Type.
<li>Fill in User Name, Password, and Server Address accordingly.</li>
<li>Click Create.</li>
</ol>
</p>

<h4>Apple iOS Calendar</h4>

<p>This client will autodetect all available calendars on a server.
  To add a Cyrus server to this client, perform the following steps:

<ol>
<li>Run the "Settings" app.</li>
<li>Select the "Mail, Contacts, Calendars" menu.</li>
<li>Select the "Add Account..." menu.</li>
<li>Select the "Other" menu.</li>
<li>Select the "Add CalDAV Account" menu.</li>
<li>Fill in Server, User Name, Password, and Description accordingly.</li>
<li>Click Next.</li>
</ol>
</p>

<h4>Evolution</h4>

<h2>CardDAV Module</h2>

<h3>Configuration</h3>

<p>When enabled, the CardDAV module allows Cyrus to function as a
  contacts server.  This module uses a subset of the
  mailbox hierarchy as addressbook collections, the toplevel of which is
  specified by the <tt>addressbookprefix</tt> option.  The public
  addressbook hierarchy will reside at the toplevel of the shared mailbox
  namespace.  A user's personal addressbook hierarchy will be a child of
  their Inbox.  For example, using the default value
  for <tt>addressbookprefix</tt>, an addressbook named <tt>Default</tt> for
  user <tt>murch</tt> would reside in the mailbox
  named <tt>user.murch.#addressbook.Default</tt>.<p>

<p><i>Note that mailboxes in the addressbook hierarchies (those
  under <tt>addressbookprefix</tt>) <b>SHOULD NOT</b> be accessed with an IMAP
  client as doing so will leave a mailbox in a state unsuitable
  for CardDAV.  To this end, addressbook mailboxes will not returned by
  Cyrus <tt>imapd</tt> in response to an IMAP client's request for the
  available mailbox list, but Cyrus <tt>imapd</tt> will not otherwise
  prevent an IMAP client from accessing them.</i></p>

<h3>Administration</h3>

<h4>Addressbook provisioning</h4>

<p>The CardDAV module with automatically create a default addressbook
  for a user the first time that the user authenticates to the CardDAV
  server.  Note that the user MUST have an
  existing <a href="install-admin-mb.html">IMAP Inbox</a> in order for
  the addressbook to be created.</p>

<h4>Addressbook access controls</h4>

<p>Cyrus uses the same access controls for addressbooks as it does for
  calendars, with the exception that the scheduling rights (7, 8, 9)
  have no use with addressbooks and are ignored.</p>

<h3>Client Setup</h3>

<h4>Apple Contacts</h4>

<p>This client will autodetect all available addressbooks on a server.
  To add a Cyrus server to this client, perform the following steps:

<ol>
<li>Select the "Contacts / Preferences" menu option.</li>
<li>Select the "Accounts" tab.</li>
<li>Click the "+" button.</li>
<li>Select "CardDAV" as the Account Type.
<li>Fill in User Name, Password, and Server Address accordingly.</li>
<li>Click Create.</li>
</ol>
</p>

<h4>Apple iOS Contacts</h4>

<p>This client will autodetect all available addressbooks on a server.
  To add a Cyrus server to this client, perform the following steps:

<ol>
<li>Run the "Settings" app.</li>
<li>Select the "Mail, Contacts, Calendars" menu.</li>
<li>Select the "Add Account..." menu.</li>
<li>Select the "Other" menu.</li>
<li>Select the "Add CardDAV Account" menu.</li>
<li>Fill in Server, User Name, Password, and Description accordingly.</li>
<li>Click Next.</li>
</ol>
</p>

<!--
<h2>iSchedule Module</h2>
-->

</body></html>
