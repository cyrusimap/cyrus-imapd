#!perl
use Cassandane::Tiny;

#
# Test uniqueid and rename
#
sub test_uniqueid
    :AltNamespace :Conversations :min_version_3_1
{
    my ($self) = @_;

    my $admintalk = $self->{adminstore}->get_client();
    my $talk = $self->{store}->get_client();

    $talk->create('foo');
    $talk->create('bar');
    $talk->create('foo');
    my $status1 = $talk->status('foo', "(mailboxid)");
    my $status2 = $talk->status('bar', "(mailboxid)");

    $talk->rename('foo', 'renamed');
    my $status3 = $talk->status('renamed', "(mailboxid)");
    my $status4 = $talk->status('bar', "(mailboxid)");

    $self->assert_str_equals($status1->{mailboxid}[0], $status3->{mailboxid}[0]);
    $self->assert_str_equals($status2->{mailboxid}[0], $status4->{mailboxid}[0]);

    $talk->list('', '*', 'return', [ "status", [ "mailboxid" ] ]);
}
