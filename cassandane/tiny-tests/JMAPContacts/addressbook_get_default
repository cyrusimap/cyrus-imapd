#!perl
use Cassandane::Tiny;

sub test_addressbook_get_default
    :min_version_3_9 :needs_dependency_icalvcard
    ($self)
{

    my $jmap = $self->{jmap};

    # XXX - A previous CardDAV test might have created the default
    # addressbook already. To make this test self-sufficient, we need
    # to create a test user just for this test. How?
    xlog $self, "get default addressbook";
    my $res = $jmap->CallMethods([['AddressBook/get', {}, "R1"]]);
    $self->assert_str_equals("/dav/addressbooks/user/cassandane/Default",
                             $res->[0][1]{list}[0]{'cyrusimap.org:href'});
    $self->assert_equals(JSON::true, $res->[0][1]{list}[0]{isDefault});
}
