#!perl
use Cassandane::Tiny;

sub test_using_unknown_capability
    :min_version_3_1
    ($self)
{
    my $jmap = $self->{jmap};

    my $res = $jmap->request({
        using => [
            'urn:ietf:params:jmap:core',
            'urn:foo' # Unknown capability
        ],
        methodCalls => [['Core/echo', { hello => JSON::true }, 'R1']],
    });

    $self->assert_str_equals('400', $res->http_response->code);

    my $Response = eval { decode_json($res->http_response->decoded_content(charset => undef)) };
    $self->assert_str_equals('urn:ietf:params:jmap:error:unknownCapability', $Response->{type});
}
